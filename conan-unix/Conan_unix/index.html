<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conan_unix (conan-unix.Conan_unix)</title><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">conan-unix</a> &#x00BB; Conan_unix</nav><header class="odoc-preamble"><h1>Module <code><span>Conan_unix</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#file-recognition.">File recognition.</a><ul><li><a href="#metadata.">Metadata.</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="file-recognition."><a href="#file-recognition." class="anchor"></a>File recognition.</h2><p><code>Conan_unix</code> provides few functions to recognize the MIME type of a given file. It implements <i>unix</i> routines to execute a decision tree <a href="../../conan/Conan/Tree/index.html#type-t"><code>Conan.Tree.t</code></a> into a file accessible via a given <i>path</i>.</p><p>The <a href="../../conan/Conan/Tree/index.html#type-t"><code>Conan.Tree.t</code></a> can come from a <i>database</i> available into a specific directory (see <code>conan-cli</code>) or the user can build/unserialize it from somewhere else.</p><p>Let's play with <code>Conan_unix</code> such as <code>&quot;/home/conan/database&quot;</code> contains our database (see <code>conan</code> or <code>man magic</code> to understand the format of the database). You must unserialize it to get the <i>decision tree</i> via:</p><pre class="language-ocaml"><code>let tree = Conan_unix.tree ~directory:&quot;/home/conan/database&quot;</code></pre><p>From this <code>tree</code>, you can process it with a file accessible via a path. Let's say that, we want to recognize the type of <code>&quot;/home/conan/file&quot;</code>, we just need:</p><pre class="language-ocaml"><code>let metadata =
  match Conan_unix.run_with_tree tree &quot;/home/conan/file&quot; with
  | Ok m -&gt; m
  | Error (`Msg err) -&gt; failwith err</code></pre><p>An equivalent of the code above is:</p><pre class="language-ocaml"><code>let metadata =
  match Conan_unix.run ~database:&quot;/home/conan/database&quot;
    &quot;/home/conan/file&quot; with
  | Ok m -&gt; m
  | Error (`Msg err) -&gt; failwith err</code></pre><p>Finally, you are able to generate a <i>decision tree</i> from a <code>string</code> instead of a directory (as before) with <a href="#val-tree_of_string"><code>tree_of_string</code></a>. Then, you are able to <i>merge</i> it with another decision tree via <a href="../../conan/Conan/Tree/index.html#val-merge"><code>Conan.Tree.merge</code></a>.</p><h3 id="metadata."><a href="#metadata." class="anchor"></a>Metadata.</h3><p>The returned <i>metadata</i> gives you two informations: 1) a possible output which describes the given file 2) a <b>possible</b> MIME type</p><p>You can get the output description <a href="../../conan/Conan/Metadata/index.html#val-output"><code>Conan.Metadata.output</code></a> and the MIME type via <a href="../../conan/Conan/Metadata/index.html#val-mime"><code>Conan.Metadata.mime</code></a>. These informations are optional - the decision tree can finish without any information.</p><div class="odoc-spec"><div class="spec value anchored" id="val-tree"><a href="#val-tree" class="anchor"></a><code><span><span class="keyword">val</span> tree : <span>directory:string <span class="arrow">&#45;&gt;</span></span> <a href="../../conan/Conan/Tree/index.html#type-t">Conan.Tree.t</a></span></code></div><div class="spec-doc"><p><code>tree ~directory</code> generates a <a href="../../conan/Conan/Tree/index.html#type-t"><code>Conan.Tree.t</code></a> from the given <code>directory</code>. It will scan <b>any</b> files from the directory (but it does not do a <b>recursive</b> traverse) and it ignores any malformed files.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tree_of_string"><a href="#val-tree_of_string" class="anchor"></a><code><span><span class="keyword">val</span> tree_of_string : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../conan/Conan/Tree/index.html#type-t">Conan.Tree.t</a>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>tree_of_string str</code> tries to construct from the given <code>str</code> a <a href="../../conan/Conan/Tree/index.html#type-t"><code>Conan.Tree.t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_with_tree"><a href="#val-run_with_tree" class="anchor"></a><code><span><span class="keyword">val</span> run_with_tree : 
  <span><a href="../../conan/Conan/Tree/index.html#type-t">Conan.Tree.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../conan/Conan/Metadata/index.html#type-t">Conan.Metadata.t</a>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>run_with_tree tree filename</code> executes the given decision <code>tree</code> on the file accessible via the path <code>filename</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span>database:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../conan/Conan/Metadata/index.html#type-t">Conan.Metadata.t</a>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>run ~database filename</code> executes the <a href="../../conan/Conan/Tree/index.html#type-t"><code>Conan.Tree.t</code></a> which results from the given directory <code>database</code> on the file accessible via the path <code>filename</code>.</p></div></div></div></body></html>