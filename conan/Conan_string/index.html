<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conan_string (conan.Conan_string)</title><link rel="stylesheet" href="../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">conan</a> &#x00BB; Conan_string</nav><header class="odoc-preamble"><h1>Module <code><span>Conan_string</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#File">recognition.</a></li></ul></nav><div class="odoc-content"><h2 id="File"><a href="#File" class="anchor"></a>recognition.</h2><p><code>Conan_string</code> is a system-free implementation of the <i>file</i> recognition. This implementation does not uses any <i>syscalls</i> - and it can be safely used into a MirageOS example.</p><p>So <code>Conan_string</code> does not have an access to a <i>database</i>. The user must rebuild a <a href="../Conan/Tree/index.html#type-t"><code>Conan.Tree.t</code></a> by himself/herself via <a href="#val-tree_of_string"><code>tree_of_string</code></a> for example. Then, from this <code>tree</code>, the user is able to recognize a <i>payload</i> as a simple <code>string</code> with <a href="#val-run"><code>run</code></a>:</p><pre class="language-ocaml"><code>let v =
  {file|0       byte    0x66
&gt;1      byte    0x6f
&gt;&gt;1     byte    0x6f    foo header
|file}

let tree = match Conan_string.tree_of_string v with
  | Ok tree -&gt; tree
  | Error (`Msg err) -&gt; failwith err

let database = Conan.Tree.database ~tree

let m = match Conan_string.run ~database contents with
  | Ok m -&gt; m
  | Error (`Msg err) -&gt; failwith err</code></pre><div class="odoc-spec"><div class="spec value anchored" id="val-tree_of_string"><a href="#val-tree_of_string" class="anchor"></a><code><span><span class="keyword">val</span> tree_of_string : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Conan/Tree/index.html#type-t">Conan.Tree.t</a>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>tree_of_string str</code> tries to parse the given <code>str</code> as a decision tree according to the <code>libmagic</code> format.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span>database:<a href="../Conan/Process/index.html#type-database">Conan.Process.database</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Conan/Metadata/index.html#type-t">Conan.Metadata.t</a>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>run ~database contents</code> tries to recognize the given <code>contents</code> with the help of <code>database</code>. The databse can be made via <a href="../Conan/Process/index.html#val-database"><code>Conan.Process.database</code></a>. Indeed, a <a href="../Conan/Tree/index.html#type-t"><code>Conan.Tree.t</code></a> can have some indirect decision paths so we must pre-process the tree to agglomerate such indirections.</p></div></div></div></body></html>